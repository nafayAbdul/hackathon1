<?xml version="1.0"?>
<robot name="athena_floating" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Include common definitions -->
  <xacro:include filename="$(find athena_description)/urdf/materials.xacro" />
  <xacro:include filename="$(find athena_description)/urdf/transmissions.xacro" />
  <xacro:include filename="$(find athena_description)/urdf/gazebo.xacro" />

  <!-- Base link with no fixed connection to world -->
  <link name="base_link">
    <inertial>
      <mass value="15.0"/>
      <origin xyz="0 0 0.4"/>
      <inertia ixx="1.2" ixy="0.0" ixz="0.0" iyy="1.2" iyz="0.0" izz="0.8"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.4" rpy="0 0 0"/>
      <geometry>
        <box size="0.18 0.18 0.8"/>
      </geometry>
      <material name="blue_material"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.4" rpy="0 0 0"/>
      <geometry>
        <box size="0.18 0.18 0.8"/>
      </geometry>
    </collision>
  </link>

  <!-- Head -->
  <link name="head">
    <inertial>
      <mass value="2.0"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.05" ixy="0.0" ixz="0.0" iyy="0.05" iyz="0.0" izz="0.05"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="0.12"/>
      </geometry>
      <material name="white_material"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="0.12"/>
      </geometry>
    </collision>
  </link>
  <joint name="neck_joint" type="revolute">
    <parent link="base_link"/>
    <child link="head"/>
    <origin xyz="0.0 0.0 0.8"/>
    <axis xyz="0 0 1"/>
    <limit lower="-0.5" upper="0.5" effort="10" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.0"/>
  </joint>

  <!-- Arms and Legs (identical to fixed version) -->
  <!-- Left Arm -->
  <xacro:arm side="left" parent="base_link" xyz="0.15 0.0 0.3"/>
  
  <xacro:macro name="arm" params="side parent xyz">
    <!-- Shoulder -->
    <link name="${side}_shoulder">
      <inertial>
        <mass value="1.5"/>
        <origin xyz="0 0 -0.08"/>
        <inertia ixx="0.02" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.005"/>
      </inertial>
      <visual>
        <origin xyz="0 0 -0.08" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.16" radius="0.06"/>
        </geometry>
        <material name="gray_material"/>
      </visual>
      <collision>
        <origin xyz="0 0 -0.08" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.16" radius="0.06"/>
        </geometry>
      </collision>
    </link>
    <joint name="${side}_shoulder_yaw" type="revolute">
      <parent link="${parent}"/>
      <child link="${side}_shoulder"/>
      <origin xyz="${xyz}"/>
      <axis xyz="0 0 1"/>
      <limit lower="-1.57" upper="1.57" effort="100" velocity="1"/>
      <dynamics damping="0.1" friction="0.0"/>
    </joint>

    <!-- Elbow -->
    <link name="${side}_elbow">
      <inertial>
        <mass value="1.0"/>
        <origin xyz="0 0 -0.1"/>
        <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.003"/>
      </inertial>
      <visual>
        <origin xyz="0 0 -0.1" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.2" radius="0.04"/>
        </geometry>
        <material name="gray_material"/>
      </visual>
      <collision>
        <origin xyz="0 0 -0.1" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.2" radius="0.04"/>
        </geometry>
      </collision>
    </link>
    <joint name="${side}_elbow_pitch" type="revolute">
      <parent link="${side}_shoulder"/>
      <child link="${side}_elbow"/>
      <origin xyz="0.0 0.0 -0.16"/>
      <axis xyz="0 1 0"/>
      <limit lower="-1.57" upper="1.57" effort="50" velocity="1"/>
      <dynamics damping="0.1" friction="0.0"/>
    </joint>

    <!-- Wrist -->
    <link name="${side}_wrist">
      <inertial>
        <mass value="0.5"/>
        <origin xyz="0 0 -0.03"/>
        <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
      </inertial>
      <visual>
        <origin xyz="0 0 -0.03" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.06" radius="0.03"/>
        </geometry>
        <material name="black_material"/>
      </visual>
      <collision>
        <origin xyz="0 0 -0.03" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.06" radius="0.03"/>
        </geometry>
      </collision>
    </link>
    <joint name="${side}_wrist_pitch" type="revolute">
      <parent link="${side}_elbow"/>
      <child link="${side}_wrist"/>
      <origin xyz="0.0 0.0 -0.2"/>
      <axis xyz="0 1 0"/>
      <limit lower="-1.0" upper="1.0" effort="20" velocity="1"/>
      <dynamics damping="0.05" friction="0.0"/>
    </joint>
  </xacro:macro>

  <!-- Right Arm -->
  <xacro:arm side="right" parent="base_link" xyz="-0.15 0.0 0.3"/>

  <!-- Left Leg -->
  <xacro:leg side="left" parent="base_link" xyz="0.05 0.0 -0.1"/>

  <xacro:macro name="leg" params="side parent xyz">
    <!-- Hip -->
    <link name="${side}_hip">
      <inertial>
        <mass value="3.0"/>
        <origin xyz="0 0 -0.15"/>
        <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.03"/>
      </inertial>
      <visual>
        <origin xyz="0 0 -0.15" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.3" radius="0.08"/>
        </geometry>
        <material name="gray_material"/>
      </visual>
      <collision>
        <origin xyz="0 0 -0.15" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.3" radius="0.08"/>
        </geometry>
      </collision>
    </link>
    <joint name="${side}_hip_yaw" type="revolute">
      <parent link="${parent}"/>
      <child link="${side}_hip"/>
      <origin xyz="${xyz}"/>
      <axis xyz="0 0 1"/>
      <limit lower="-0.5" upper="0.5" effort="200" velocity="1"/>
      <dynamics damping="0.2" friction="0.01"/>
    </joint>

    <!-- Knee -->
    <link name="${side}_knee">
      <inertial>
        <mass value="2.5"/>
        <origin xyz="0 0 -0.2"/>
        <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.02"/>
      </inertial>
      <visual>
        <origin xyz="0 0 -0.2" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.4" radius="0.07"/>
        </geometry>
        <material name="gray_material"/>
      </visual>
      <collision>
        <origin xyz="0 0 -0.2" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.4" radius="0.07"/>
        </geometry>
      </collision>
    </link>
    <joint name="${side}_knee_pitch" type="revolute">
      <parent link="${side}_hip"/>
      <child link="${side}_knee"/>
      <origin xyz="0.0 0.0 -0.3"/>
      <axis xyz="0 1 0"/>
      <limit lower="0" upper="2.0" effort="200" velocity="1"/>
      <dynamics damping="0.2" friction="0.01"/>
    </joint>

    <!-- Ankle -->
    <link name="${side}_ankle">
      <inertial>
        <mass value="1.0"/>
        <origin xyz="0.05 0 -0.01"/>
        <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.01"/>
      </inertial>
      <visual>
        <origin xyz="0.05 0 -0.01" rpy="0 0 0"/>
        <geometry>
          <box size="0.12 0.08 0.02"/>
        </geometry>
        <material name="black_material"/>
      </visual>
      <collision>
        <origin xyz="0.05 0 -0.01" rpy="0 0 0"/>
        <geometry>
          <box size="0.12 0.08 0.02"/>
        </geometry>
      </collision>
    </link>
    <joint name="${side}_ankle_pitch" type="revolute">
      <parent link="${side}_knee"/>
      <child link="${side}_ankle"/>
      <origin xyz="0.0 0.0 -0.4"/>
      <axis xyz="0 1 0"/>
      <limit lower="-0.5" upper="0.5" effort="100" velocity="1"/>
      <dynamics damping="0.1" friction="0.0"/>
    </joint>
  </xacro:macro>

  <!-- Right Leg -->
  <xacro:leg side="right" parent="base_link" xyz="-0.05 0.0 -0.1"/>

  <!-- Gazebo plugins -->
  <gazebo>
    <plugin name="gazebo_ros2_control" filename="libgazebo_ros2_control.so">
      <parameters>$(find athena_description)/config/athena_control.yaml</parameters>
    </plugin>
  </gazebo>

</robot>